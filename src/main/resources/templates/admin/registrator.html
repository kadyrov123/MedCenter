<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.w3.org/1999/xhtml">

<head>
    <th:block th:insert="admin/fragments/layout :: head"></th:block>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
</head>

<body>
<!-- Sidenav -->
<nav class="sidenav navbar navbar-vertical  fixed-left  navbar-expand-xs navbar-light bg-white" id="sidenav-main">
    <div class="scrollbar-inner">
        <!-- Brand -->
        <div class="sidenav-header  align-items-center">
            <a class="navbar-brand" href="javascript:void(0)">
                <img src="../assets/img/brand/blue.png" class="navbar-brand-img" alt="...">
            </a>
        </div>
        <div class="navbar-inner">
            <!-- Collapse -->
            <div class="collapse navbar-collapse" id="sidenav-collapse-main">
                <!-- Nav items -->
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" href="dashboard.html">
                            <i class="ni ni-tv-2 text-primary"></i>
                            <span class="nav-link-text">Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="icons.html">
                            <i class="ni ni-planet text-orange"></i>
                            <span class="nav-link-text">Icons</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="map.html">
                            <i class="ni ni-pin-3 text-primary"></i>
                            <span class="nav-link-text">Google</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="profile.html">
                            <i class="ni ni-single-02 text-yellow"></i>
                            <span class="nav-link-text">Profile</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="tables.html">
                            <i class="ni ni-bullet-list-67 text-default"></i>
                            <span class="nav-link-text">Tables</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="login.html">
                            <i class="ni ni-key-25 text-info"></i>
                            <span class="nav-link-text">Login</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="register.html">
                            <i class="ni ni-circle-08 text-pink"></i>
                            <span class="nav-link-text">Register</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="upgrade.html">
                            <i class="ni ni-send text-dark"></i>
                            <span class="nav-link-text">Upgrade</span>
                        </a>
                    </li>
                </ul>
                <!-- Divider -->
                <hr class="my-3">
                <!-- Heading -->
                <h6 class="navbar-heading p-0 text-muted">
                    <span class="docs-normal">Documentation</span>
                </h6>
                <!-- Navigation -->
                <ul class="navbar-nav mb-md-3">
                    <li class="nav-item">
                        <a class="nav-link" href="https://demos.creative-tim.com/argon-dashboard/docs/getting-started/overview.html" target="_blank">
                            <i class="ni ni-spaceship"></i>
                            <span class="nav-link-text">Getting started</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://demos.creative-tim.com/argon-dashboard/docs/foundation/colors.html" target="_blank">
                            <i class="ni ni-palette"></i>
                            <span class="nav-link-text">Foundation</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://demos.creative-tim.com/argon-dashboard/docs/components/alerts.html" target="_blank">
                            <i class="ni ni-ui-04"></i>
                            <span class="nav-link-text">Components</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://demos.creative-tim.com/argon-dashboard/docs/plugins/charts.html" target="_blank">
                            <i class="ni ni-chart-pie-35"></i>
                            <span class="nav-link-text">Plugins</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active active-pro" href="upgrade.html">
                            <i class="ni ni-send text-dark"></i>
                            <span class="nav-link-text">Upgrade to PRO</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</nav>
<!-- Main content -->
<div class="main-content" id="panel">
    <!-- Topnav -->
    <nav class="navbar navbar-top navbar-expand navbar-dark bg-primary border-bottom">
        <div class="container-fluid">
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <!-- Search form -->

                <!-- Navbar links -->
                <ul class="navbar-nav align-items-center  ml-md-auto ">
                    <li class="nav-item d-xl-none">
                        <!-- Sidenav toggler -->
                        <div class="pr-3 sidenav-toggler sidenav-toggler-dark" data-action="sidenav-pin" data-target="#sidenav-main">
                            <div class="sidenav-toggler-inner">
                                <i class="sidenav-toggler-line"></i>
                                <i class="sidenav-toggler-line"></i>
                                <i class="sidenav-toggler-line"></i>
                            </div>
                        </div>
                    </li>
                    <li class="nav-item d-sm-none">
                        <a class="nav-link" href="#" data-action="search-show" data-target="#navbar-search-main">
                            <i class="ni ni-zoom-split-in"></i>
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="ni ni-bell-55"></i>
                        </a>
                        <div class="dropdown-menu dropdown-menu-xl  dropdown-menu-right  py-0 overflow-hidden">
                            <!-- Dropdown header -->
                            <div class="px-3 py-3">
                                <h6 class="text-sm text-muted m-0">You have <strong class="text-primary">13</strong> notifications.</h6>
                            </div>
                            <!-- List group -->
                            <div class="list-group list-group-flush">
                                <a href="#!" class="list-group-item list-group-item-action">
                                    <div class="row align-items-center">
                                        <div class="col-auto">
                                            <!-- Avatar -->
                                            <img alt="Image placeholder" src="../../assets/img/theme/team-1.jpg" class="avatar rounded-circle">
                                        </div>
                                        <div class="col ml--2">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div>
                                                    <h4 class="mb-0 text-sm">John Snow</h4>
                                                </div>
                                                <div class="text-right text-muted">
                                                    <small>2 hrs ago</small>
                                                </div>
                                            </div>
                                            <p class="text-sm mb-0">Let's meet at Starbucks at 11:30. Wdyt?</p>
                                        </div>
                                    </div>
                                </a>
                                <a href="#!" class="list-group-item list-group-item-action">
                                    <div class="row align-items-center">
                                        <div class="col-auto">
                                            <!-- Avatar -->
                                            <img alt="Image placeholder" src="../assets/img/theme/team-2.jpg" class="avatar rounded-circle">
                                        </div>
                                        <div class="col ml--2">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div>
                                                    <h4 class="mb-0 text-sm">John Snow</h4>
                                                </div>
                                                <div class="text-right text-muted">
                                                    <small>3 hrs ago</small>
                                                </div>
                                            </div>
                                            <p class="text-sm mb-0">A new issue has been reported for Argon.</p>
                                        </div>
                                    </div>
                                </a>
                                <a href="#!" class="list-group-item list-group-item-action">
                                    <div class="row align-items-center">
                                        <div class="col-auto">
                                            <!-- Avatar -->
                                            <img alt="Image placeholder" src="../assets/img/theme/team-3.jpg" class="avatar rounded-circle">
                                        </div>
                                        <div class="col ml--2">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div>
                                                    <h4 class="mb-0 text-sm">John Snow</h4>
                                                </div>
                                                <div class="text-right text-muted">
                                                    <small>5 hrs ago</small>
                                                </div>
                                            </div>
                                            <p class="text-sm mb-0">Your posts have been liked a lot.</p>
                                        </div>
                                    </div>
                                </a>
                                <a href="#!" class="list-group-item list-group-item-action">
                                    <div class="row align-items-center">
                                        <div class="col-auto">
                                            <!-- Avatar -->
                                            <img alt="Image placeholder" src="../assets/img/theme/team-4.jpg" class="avatar rounded-circle">
                                        </div>
                                        <div class="col ml--2">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div>
                                                    <h4 class="mb-0 text-sm">John Snow</h4>
                                                </div>
                                                <div class="text-right text-muted">
                                                    <small>2 hrs ago</small>
                                                </div>
                                            </div>
                                            <p class="text-sm mb-0">Let's meet at Starbucks at 11:30. Wdyt?</p>
                                        </div>
                                    </div>
                                </a>
                                <a href="#!" class="list-group-item list-group-item-action">
                                    <div class="row align-items-center">
                                        <div class="col-auto">
                                            <!-- Avatar -->
                                            <img alt="Image placeholder" src="../assets/img/theme/team-5.jpg" class="avatar rounded-circle">
                                        </div>
                                        <div class="col ml--2">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div>
                                                    <h4 class="mb-0 text-sm">John Snow</h4>
                                                </div>
                                                <div class="text-right text-muted">
                                                    <small>3 hrs ago</small>
                                                </div>
                                            </div>
                                            <p class="text-sm mb-0">A new issue has been reported for Argon.</p>
                                        </div>
                                    </div>
                                </a>
                            </div>
                            <!-- View all -->
                            <a href="#!" class="dropdown-item text-center text-primary font-weight-bold py-3">View all</a>
                        </div>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="ni ni-ungroup"></i>
                        </a>
                        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-dark bg-default  dropdown-menu-right ">
                            <div class="row shortcuts px-4">
                                <a href="#!" class="col-4 shortcut-item">
                    <span class="shortcut-media avatar rounded-circle bg-gradient-red">
                      <i class="ni ni-calendar-grid-58"></i>
                    </span>
                                    <small>Calendar</small>
                                </a>
                                <a href="#!" class="col-4 shortcut-item">
                    <span class="shortcut-media avatar rounded-circle bg-gradient-orange">
                      <i class="ni ni-email-83"></i>
                    </span>
                                    <small>Email</small>
                                </a>
                                <a href="#!" class="col-4 shortcut-item">
                    <span class="shortcut-media avatar rounded-circle bg-gradient-info">
                      <i class="ni ni-credit-card"></i>
                    </span>
                                    <small>Payments</small>
                                </a>
                                <a href="#!" class="col-4 shortcut-item">
                    <span class="shortcut-media avatar rounded-circle bg-gradient-green">
                      <i class="ni ni-books"></i>
                    </span>
                                    <small>Reports</small>
                                </a>
                                <a href="#!" class="col-4 shortcut-item">
                    <span class="shortcut-media avatar rounded-circle bg-gradient-purple">
                      <i class="ni ni-pin-3"></i>
                    </span>
                                    <small>Maps</small>
                                </a>
                                <a href="#!" class="col-4 shortcut-item">
                    <span class="shortcut-media avatar rounded-circle bg-gradient-yellow">
                      <i class="ni ni-basket"></i>
                    </span>
                                    <small>Shop</small>
                                </a>
                            </div>
                        </div>
                    </li>
                </ul>
                <ul class="navbar-nav align-items-center  ml-auto ml-md-0 ">
                    <li class="nav-item dropdown">
                        <a class="nav-link pr-0" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <div class="media align-items-center">
                  <span class="avatar avatar-sm rounded-circle">
                    <img alt="Image placeholder" src="../assets/img/theme/team-4.jpg">
                  </span>
                                <div class="media-body  ml-2  d-none d-lg-block">
                                    <span class="mb-0 text-sm  font-weight-bold">John Snow</span>
                                </div>
                            </div>
                        </a>
                        <div class="dropdown-menu  dropdown-menu-right ">
                            <div class="dropdown-header noti-title">
                                <h6 class="text-overflow m-0">Welcome!</h6>
                            </div>
                            <a href="#!" class="dropdown-item">
                                <i class="ni ni-single-02"></i>
                                <span>My profile</span>
                            </a>
                            <a href="#!" class="dropdown-item">
                                <i class="ni ni-settings-gear-65"></i>
                                <span>Settings</span>
                            </a>
                            <a href="#!" class="dropdown-item">
                                <i class="ni ni-calendar-grid-58"></i>
                                <span>Activity</span>
                            </a>
                            <a href="#!" class="dropdown-item">
                                <i class="ni ni-support-16"></i>
                                <span>Support</span>
                            </a>
                            <div class="dropdown-divider"></div>
                            <a href="#!" class="dropdown-item">
                                <i class="ni ni-user-run"></i>
                                <span>Logout</span>
                            </a>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- Header -->


    <!-- ================================================================== Main Plane =========================================================================================-->
    <div class="header bg-primary pb-6" style="background-color: #21385f !important;">
        <div class="container-fluid">
            <div class="header-body">
                <div class="row align-items-center py-4">
                    <div class="col-lg-6 col-7">
                        <h6 class="h2 text-white d-inline-block mb-0">Пациенты</h6>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid mt--6" >
        <div class="row">

            <div class="col">
                <div class="card">
                    <div class="card-header border-info">
                        <div class="row align-items-center">
                            <div class="col-8">

                            </div>
                            <div class="col-4">
                                <select type="text" name="endTime" class="form-control" id="selectDoctor"   >
                                    <option th:each="doctor : ${doctors}" th:text="${doctor.usersByDoctorId.surname + ' ' + doctor.usersByDoctorId.name}" th:data-doctorid="${doctor.id}"></option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="card-body">
                        <div class="table-responsive">
                            <table id="patientsTable" class="table align-items-center table-flush table-hover">
                                <thead class="thead-light">
                                <tr>
                                    <th scope="col" class="sort" data-sort="name">ФИО</th>
                                    <th scope="col" class="sort" data-sort="status">Время</th>
                                </tr>
                                </thead>
                                <tbody id="patientsTableBody" class="list">
                                <tr th:each="patient : ${patientList}" class="my-clickable-row" >
                                    <td  th:text="${patient.surname + ' ' + patient.name}"></td>
        <!--                            <td  th:text="${patient.queueEntity.doctorFeaturesByDoctorId.usersByDoctorId.surname + ' ' + patient.queueEntity.doctorFeaturesByDoctorId.usersByDoctorId.name}"></td>-->
                                    <td  th:text="${patient.queueEntity.time}" ></td>
                                    <td class="text-right" th:if="${patient.canBeCanceled}">
                                        <div class="dropdown">
                                            <form th:action="@{/registrator/queue/__${patient.queueEntity.id}__/cancel}" method="get" >
                                                <button class="btn btn-sm btn-icon-only text-light" type="submit" >
                                                    <i class="ni ni-fat-remove" style="font-size: 30px;"></i>
                                                </button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>

                    </div>
                </div>

            </div>
        </div>

</div>

    <div class="container-fluid mt--6" style="margin-top: 1.5rem !important;">
        <div class="row">
            <div class="col">
                <div class="card">
                    <div class="card">
                        <!-- Card header -->
                        <div class="card-header border-success">
                            <h2 class="mb-0">Добавить пациента в очередь</h2>
                        </div>
                        <!-- Light table -->
                        <div class="card-body">
                            <form th:action="@{/registrator/save/patient}" method="post">
                                <div class="form-group">
                                    <label for="name" class="form-control-label">Имя</label>
                                    <input class="form-control" type="text" placeholder="John" id="name" name="firstname">
                                </div>
                                <div class="form-group">
                                    <label for="surname" class="form-control-label">Фамилия</label>
                                    <input class="form-control" type="text" placeholder="Snow" id="surname" name="lastname">
                                </div>
                                <div class="form-group">
                                    <label for="selectDoctor2" class="form-control-label">Доктор</label>
                                    <select type="text" name="doctorId" class="form-control" id="selectDoctor2"   >
                                        <option th:each="doctor : ${doctors}" th:text="${doctor.usersByDoctorId.surname + ' ' + doctor.usersByDoctorId.name}" th:value="${doctor.id}" th:data-doctorid="${doctor.id}"></option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="selectTime" class="form-control-label">Время</label>
                                    <select type="text" name="order" class="form-control" id="selectTime"  >

                                    </select>
                                </div>

                                <input class="btn btn-success" type="submit" value="Добавить">

                            </form>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>

<script>
    // $(document).ready(function () {

    var patientList = null;
    var timeList = null;

    $('#selectDoctor').change(function () {
        getPatientList();
    });

    getPatientList();
    function getPatientList(){
        var doctorid = $( "#selectDoctor option:selected" ).attr("data-doctorid");
        $.ajax({
            url : '/registrator/getPatientList',
            type: 'GET',
            dataType: 'json',
            contentType: 'application/json',
            mimeType: 'application/json',
            data : ({
                doctorId : doctorid
            }),
            success: function (data) {
                console.log(data);
                patientList = data;
                fillPatientTable();
            }
        });
    }

    $('#selectDoctor2').change(function () {
        getTimeListByDoctorId();
    });

    getTimeListByDoctorId();
    function getTimeListByDoctorId(){
        var doctorid = $( "#selectDoctor2 option:selected" ).attr("data-doctorid");
        $.ajax({
            url : '/registrator/getTimeListByDoctorId',
            type: 'GET',
            dataType: 'json',
            contentType: 'application/json',
            mimeType: 'application/json',
            data : ({
                doctorId : doctorid
            }),
            success: function (data) {
                timeList = data;
                console.log(data);
                // console.log(timeList[0].time);
                fillTimeList();
            }
        });
    }


    function fillPatientTable(){
        // $("patientsTable tbody")
        $("#patientsTableBody tr").remove();
        var tbody = document.getElementById("patientsTableBody");
        for (var i=0 ; i<patientList.length ;i++ ){
            var tr = document.createElement("tr");
            // tr.setAttribute("class" , "my-clickable-row");
            // tr.setAttribute("onclick" , "openPatientProfile(this);");
            // tr.setAttribute("data-patientid",patientList[i][4]);
            // for(var j=1 ; j<patientList[i].length-1 ; j++){

            for(var j=1 ; j<patientList[i].length ; j++) {
                var td = document.createElement("td");
                // td.setAttribute("class" , "my-clickable-row");
                if (j == 3) {
                    if(patientList[i][3]=='true') {
                        var cancelTD = '<td class="text-right" >\n' +
                            '                                        <div class="dropdown">\n' +
                            '                                            <form action="/registrator/queue/' + patientList[i][0] + '/cancel" method="get" >\n' +
                            '                                                <button class="btn btn-sm btn-icon-only text-light" type="submit" >\n' +
                            '                                                    <i class="ni ni-fat-remove" style="font-size: 30px;"></i>\n' +
                            '                                                </button>\n' +
                            '                                            </form>\n' +
                            '                                        </div>\n' +
                            '                                    </td>';
                        tr.insertAdjacentHTML('beforeend', cancelTD);
                    }
                }
                else{
                    td.appendChild(document.createTextNode(patientList[i][j]));
                    td.setAttribute("data-queueid", patientList[i][0]);
                    tr.appendChild(td);
                }


            }
            tbody.appendChild(tr);
        }
    }

    function fillTimeList(){
        // $("patientsTable tbody")
        $("#selectTime option").remove();
        var selectTime = document.getElementById("selectTime");
        for (var i=0 ; i<timeList.length ;i++ ){
            if(timeList[i].free) {
                var option = document.createElement("option");
                option.appendChild(document.createTextNode(timeList[i].time));
                option.setAttribute("data-order", timeList[i].order);
                option.setAttribute("data-free", timeList[i].free);
                option.setAttribute("value", timeList[i].order);
                selectTime.appendChild(option);
            }
        }
    }


    // function openPatientProfile(row) {
    //     var patientid = row.dataset.patientid;
    //     window.location = "/doctor/patient/" +patientid + "/profile";
    // }
    // })
</script>
<!--<script>-->
<!--    $(document).ready(function(){-->
<!--        $('.my-clickable-row').on("click" , function () {-->
<!--            var doctorId = $(this).attr("data-doctorid");-->
<!--            window.location = "/admin/doctor/" +doctorId + "/profile";-->
<!--        });-->

<!--    });-->
<!--</script>-->


<!-- Argon Scripts -->
<!-- Core -->
<script th:src="@{/assets/vendor/jquery/dist/jquery.min.js}"></script>
<script th:src="@{/assets/vendor/bootstrap/dist/js/bootstrap.bundle.min.js}"></script>
<script th:src="@{/assets/vendor/js-cookie/js.cookie.js}"></script>
<script th:src="@{/assets/vendor/jquery.scrollbar/jquery.scrollbar.min.js}"></script>
<script th:src="@{/assets/vendor/jquery-scroll-lock/dist/jquery-scrollLock.min.js}"></script>
<!-- Optional JS -->
<script th:src="@{/assets/vendor/chart.js/dist/Chart.min.js}"></script>
<script th:src="@{/assets/vendor/chart.js/dist/Chart.extension.js}"></script>
<!-- Argon JS -->
<script th:src="@{/assets/js/argon.js?v=1.2.0}"></script>

</body>

</html>